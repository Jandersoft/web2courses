# -*- coding: utf-8 -*-

@auth.requires_login()
def my_courses():
    courses = db(Student).select(Student.class_id)
    return dict(courses=courses)

def courses():
    courses = db(Course).select()
    return dict(courses=courses)

def classes():
    if request.vars.course:
        classes = db(Class.course == request.vars.course).select(Class.course, Class.status)
    else:
        classes = db(Class).select(Class.course, Class.status)
    return dict(classes=classes)

def new_course():
    form = SQLFORM(Course)
    if form.process().accepted:
        session.flash = "New course!"
        redirect(URL('courses'))
    elif form.errors:
        response.flash = "Errors in form!"
    return dict(form=form)

def new_class():
    form = SQLFORM(Class)
    if form.process().accepted:
        session.flash = "New class!"
        redirect(URL('classes', vars={'course':form.vars.course}))
    elif form.errors:
        response.flash = "Errors in form!"
    return dict(form=form)

def enroll():
    if not request.vars.class_id:
        session.flash = "No class selected!"
        redirect(URL('courses'))
        
    Student.insert(student=auth.user.id, class_id=request.vars.class_id, status=1)
    redirect(URL('my_courses'))
